<?xml version="1.0" encoding="UTF-8"?>

<entity-mappings xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm_2_2.xsd"
                 version="2.2">

    <mapped-superclass class="io.smarthealth.infrastructure.domain.Identifiable">
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
        </attributes>
    </mapped-superclass>
    
    <!--Price list Fetch-->
    <named-native-query name="pricelistEntity.getAllPriceList">
        <query><![CDATA[
            SELECT i.id, i.item_code as itemCode,i.item_name as itemName, i.item_type as itemType, i.rate AS defaultRate,
                case when pb.is_increase then (pb.percentage*i.rate/100+i.rate) ELSE (i.rate-pb.percentage*i.rate/100) end  AS specialRate,
                    si.effective_date as effectiveDate, sp.id as servicePointId,sp.name AS servicePoint, pb.id AS pricebookId, pb.name AS pricebook 
                    FROM service_items si,  product_services i, service_points sp, price_book pb 
                    WHERE si.service_type_id=i.id AND si.service_point_id=sp.id
                UNION
            SELECT i.id, i.item_code as itemCode,i.item_name as itemName, i.item_type as itemType, i.rate AS defaultRate,(i.rate) AS specialRate,si.effective_date as effectiveDate, sp.id as servicePointId,sp.name AS servicePoint, 
                0, 'Defult Price' AS pricebook FROM service_items si,  product_services i, service_points sp, price_book pb 
                    WHERE si.service_type_id=i.id AND si.service_point_id=sp.id;
         ]]>
        </query>
    </named-native-query>
    
    <!--Search Pricelist by item and pricebook-->
    <named-native-query name="pricelistEntity.searchPriceListByItem">
        <query><![CDATA[
            SELECT i.id, i.item_code as itemCode,i.item_name as itemName, i.item_type as itemType, i.rate AS defaultRate,
                case when pb.is_increase then (pb.percentage*i.rate/100+i.rate) ELSE (i.rate-pb.percentage*i.rate/100) end  AS specialRate,
                    si.effective_date as effectiveDate, sp.id as servicePointId,sp.name AS servicePoint, pb.id AS pricebookId, pb.name AS pricebook 
                    FROM service_items si,  product_services i, service_points sp, price_book pb 
                    WHERE si.service_type_id=i.id AND si.service_point_id=sp.id AND i.item_name LIKE :item
                UNION
            SELECT i.id, i.item_code as itemCode,i.item_name as itemName, i.item_type as itemType, i.rate AS defaultRate,(i.rate) AS specialRate,si.effective_date as effectiveDate, sp.id as servicePointId,sp.name AS servicePoint, 
                0, 'Defult Price' AS pricebook FROM service_items si,  product_services i, service_points sp, price_book pb 
                    WHERE si.service_type_id=i.id AND si.service_point_id=sp.id AND i.item_name LIKE :item;
         ]]>
        </query>
    </named-native-query>

</entity-mappings>
